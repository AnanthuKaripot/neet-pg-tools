<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>NEET PG Tools - Timetable Generator</title>
    <link href="{{ url_for('static', filename='dist/output.css') }}?v=darkmode" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="selection:bg-primary-500 selection:text-white">

    <div class="container mx-auto px-4 py-8 max-w-6xl">

        <!-- Header -->
        <div class="mb-10 animate-fade-in-up">
            <a href="{{ url_for('home') }}"
                class="text-primary-500 hover:text-primary-400 font-medium mb-4 inline-flex items-center transition-colors">
                <i class="fas fa-arrow-left mr-2 bg-primary-500/10 p-2 rounded-full"></i> Back to Home
            </a>
            <h2 class="text-3xl md:text-4xl font-bold text-center text-white mt-4">
                Study Timetable Generator
            </h2>
            <p class="text-slate-400 text-center mt-2 max-w-2xl mx-auto">Create a personalized study schedule for NEET
                PG preparation with automatic revision planning.</p>
        </div>

        <!-- Error Message -->
        {% if error %}
        <div
            class="bg-red-500/10 border border-red-500/20 rounded-xl p-6 mb-8 text-center text-red-400 animate-fade-in">
            <i class="fas fa-exclamation-circle text-2xl mb-2 opacity-80"></i>
            <p class="font-bold">{{ error }}</p>
        </div>
        {% endif %}

        <!-- Timetable Form Card -->
        <div class="card p-6 md:p-10 mb-12 ring-1 ring-white/5 bg-dark-800/80 backdrop-blur-xl">
            <form method="POST" id="timetable-form" class="space-y-8">

                <!-- Date and Hours Section -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div>
                        <label for="start-date"
                            class="block text-sm font-medium text-slate-300 mb-2 uppercase tracking-wide">
                            Start Date
                        </label>
                        <div class="relative">
                            <input type="date" id="start-date" name="start_date" class="form-input pl-10"
                                value="{{ start_date }}" required>
                            <i class="fas fa-calendar absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
                        </div>
                    </div>

                    <div>
                        <label for="end-date"
                            class="block text-sm font-medium text-slate-300 mb-2 uppercase tracking-wide">
                            End Date
                        </label>
                        <div class="relative">
                            <input type="date" id="end-date" name="end_date" class="form-input pl-10"
                                value="{{ end_date }}" required>
                            <i
                                class="fas fa-calendar-check absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
                        </div>
                    </div>

                    <div>
                        <label for="daily-hours"
                            class="block text-sm font-medium text-slate-300 mb-2 uppercase tracking-wide">
                            Daily Study Hours
                        </label>
                        <div class="relative">
                            <input type="number" id="daily-hours" name="daily_hours" class="form-input pl-10" min="1"
                                max="24" value="{{ daily_hours }}" required>
                            <i class="fas fa-clock absolute left-3 top-1/2 -translate-y-1/2 text-slate-500"></i>
                        </div>
                    </div>
                </div>

                <!-- Subjects Section -->
                <div>
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                        <i class="fas fa-book-medical text-purple-500 mr-3"></i>
                        Select Subjects & Allocate Hours
                    </h3>
                    <p class="text-slate-400 text-sm mb-6">Choose subjects you want to study and set hours for each.
                        Default hours are recommendations.</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {% for subject, default_hours in subjects.items() %}
                        <div
                            class="bg-dark-700/50 rounded-lg p-4 border border-dark-600 hover:border-purple-500/50 transition-all">
                            <label class="flex items-center justify-between">
                                <span class="text-slate-200 font-medium text-sm">{{ subject }}</span>
                                <div class="flex items-center gap-2">
                                    <input type="number" name="hours_{{ subject }}" id="hours_{{ subject }}"
                                        class="w-16 px-2 py-1 bg-dark-800 border border-dark-600 rounded text-white text-sm text-center focus:border-purple-500 focus:ring-1 focus:ring-purple-500 outline-none"
                                        min="0" max="200" value="{{ selected_subjects.get(subject, default_hours) }}"
                                        placeholder="{{ default_hours }}">
                                    <span class="text-slate-500 text-xs">hrs</span>
                                </div>
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="pt-6 flex gap-4">
                    <button type="submit"
                        class="flex-1 btn-primary text-lg flex justify-center items-center py-4 bg-purple-600 hover:bg-purple-700 shadow-purple-900/20">
                        <i class="fas fa-calendar-plus mr-2"></i> Generate Timetable
                    </button>
                </div>
            </form>
        </div>

        <!-- Results Section -->
        {% if schedule %}
        <div class="results-section space-y-10 animate-fade-in-up">

            <!-- Timetable Display -->
            <div class="card overflow-hidden">
                <div class="table-header bg-purple-700 flex justify-between items-center border-b border-purple-600">
                    <span class="text-white"><i class="fas fa-calendar-alt text-purple-300 mr-2"></i> Your Study
                        Schedule</span>
                    <span
                        class="bg-purple-500/20 text-purple-300 border border-purple-500/30 text-xs py-1 px-3 rounded-full font-mono">
                        {{ schedule|length }} Days
                    </span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-dark-800 text-slate-400 uppercase text-xs font-bold tracking-wider">
                            <tr>
                                <th class="px-6 py-4">Date</th>
                                <th class="px-6 py-4">Day</th>
                                <th class="px-6 py-4">Subjects & Hours</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-dark-700 bg-dark-800">
                            {% for day in schedule %}
                            <tr class="table-row group hover:bg-dark-700/50">
                                <td class="table-cell font-mono text-purple-400">{{ day.date }}</td>
                                <td class="table-cell text-slate-300">{{ day.day_name }}</td>
                                <td class="table-cell">
                                    <div class="flex flex-wrap gap-2">
                                        {% for subject in day.subjects %}
                                        <span
                                            class="px-3 py-1 rounded-full bg-purple-500/10 text-purple-300 text-sm border border-purple-500/20">
                                            {{ subject.name }} ({{ subject.hours }}h)
                                        </span>
                                        {% endfor %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Revision Schedule -->
            {% if revision_schedule %}
            <div class="card overflow-hidden">
                <div class="table-header bg-emerald-700 flex justify-between items-center border-b border-emerald-600">
                    <span class="text-white"><i class="fas fa-redo text-emerald-300 mr-2"></i> Revision Schedule</span>
                    <span
                        class="bg-emerald-500/20 text-emerald-300 border border-emerald-500/30 text-xs py-1 px-3 rounded-full font-mono">
                        {{ revision_schedule|length }} Sessions
                    </span>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-dark-800 text-slate-400 uppercase text-xs font-bold tracking-wider">
                            <tr>
                                <th class="px-6 py-4">Date</th>
                                <th class="px-6 py-4">Subject</th>
                                <th class="px-6 py-4">Type</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-dark-700 bg-dark-800">
                            {% for rev in revision_schedule %}
                            <tr class="table-row group hover:bg-dark-700/50">
                                <td class="table-cell font-mono text-emerald-400">{{ rev.date }}</td>
                                <td class="table-cell text-slate-200">{{ rev.subject }}</td>
                                <td class="table-cell">
                                    <span
                                        class="px-3 py-1 rounded-full bg-emerald-500/10 text-emerald-300 text-sm border border-emerald-500/20">
                                        {{ rev.type }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            <!-- Download PDF Button -->
            <div class="text-center">
                <form method="POST" action="{{ url_for('download_timetable') }}" class="inline-block">
                    <!-- Hidden fields to pass data -->
                    <input type="hidden" name="start_date" value="{{ start_date }}">
                    <input type="hidden" name="end_date" value="{{ end_date }}">
                    <input type="hidden" name="daily_hours" value="{{ daily_hours }}">
                    {% for subject, hours in selected_subjects.items() %}
                    <input type="hidden" name="hours_{{ subject }}" value="{{ hours }}">
                    {% endfor %}

                    <button type="submit"
                        class="btn-primary text-lg px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 shadow-lg shadow-purple-900/30">
                        <i class="fas fa-download mr-2"></i> Download PDF Timetable
                    </button>
                </form>
            </div>

        </div>
        {% endif %}

    </div>

    <script src="{{ url_for('static', filename='main.js') }}"></script>
</body>

</html>