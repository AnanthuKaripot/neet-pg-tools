<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Your NEET PG Timetable</title>
    <!-- Tailwind CSS -->
    <link href="{{ url_for('static', filename='dist/output.css') }}?v=darkmode" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body class="selection:bg-primary-500 selection:text-white">

    <!-- Controls -->
    <div class="container mx-auto px-4 py-6 no-print">
        <div class="flex justify-end gap-3">
            <button onclick="document.getElementById('pdfForm').submit()"
                class="px-6 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white rounded-xl transition-all shadow-lg">
                <i class="fas fa-download mr-2"></i>Download PDF
            </button>
            <a href="/timetable"
                class="px-6 py-3 bg-dark-800 border border-dark-700 hover:bg-dark-700 text-slate-300 rounded-xl transition-all">
                <i class="fas fa-plus mr-2"></i>Create New
            </a>
        </div>
    </div>

    <!-- Hidden form for PDF download -->
    <form id="pdfForm" action="/download-timetable-pdf" method="POST" style="display: none;">
        <input type="hidden" name="from_date" value="{{ form_data.from_date }}">
        <input type="hidden" name="to_date" value="{{ form_data.to_date }}">
        <input type="hidden" name="revision_days" value="{{ form_data.revision_days }}">
        <input type="hidden" name="daily_hours" value="{{ form_data.daily_hours }}">
        {% for slot in form_data.time_slots %}
        <input type="hidden" name="time_slots" value="{{ slot }}">
        {% endfor %}
        <input type="hidden" name="grant_test_frequency" value="{{ form_data.grant_test_frequency }}">
        <input type="hidden" name="method" value="{{ form_data.method }}">
    </form>

    <div class="container mx-auto px-4 py-8 max-w-7xl">

        <!-- Hero Section -->
        <div class="text-center mb-12">
            <h1
                class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-cyan-400 to-emerald-400 mb-3">
                Your Preparation Schedule
            </h1>
            <p class="text-slate-400 text-lg">Generated by NEET PG Timetable AI</p>
        </div>

        <!-- Duration Stats -->
        <div class="card p-8 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                <div class="space-y-2">
                    <p class="text-slate-500 text-sm font-semibold uppercase tracking-wide">Total Duration</p>
                    <p class="text-4xl font-bold text-white">{{ stats.total_days }} <span
                            class="text-xl text-slate-400">Days</span></p>
                </div>
                {% if stats.main_days > 0 %}
                <div class="space-y-2 border-l border-r border-dark-700">
                    <p class="text-slate-500 text-sm font-semibold uppercase tracking-wide">Main Phase</p>
                    <p class="text-4xl font-bold text-blue-400">{{ stats.main_days }} <span
                            class="text-xl text-slate-400">Days</span></p>
                </div>
                {% endif %}
                <div class="space-y-2">
                    <p class="text-slate-500 text-sm font-semibold uppercase tracking-wide">Revision Phase</p>
                    <p class="text-4xl font-bold text-emerald-400">{{ stats.rev_days }} <span
                            class="text-xl text-slate-400">Days</span></p>
                </div>
            </div>
        </div>

        <!-- Main Timetable -->
        {% if main.days %}
        <div class="card p-8 mb-8">
            <h2 class="text-2xl font-bold text-blue-400 mb-6 pb-3 border-b border-dark-700">
                <i class="fas fa-book-open mr-2"></i>Part I: Main Timetable
            </h2>

            <!-- Summary -->
            <details class="mb-6">
                <summary
                    class="cursor-pointer text-lg font-semibold text-slate-300 hover:text-white transition-colors p-4 bg-dark-800 rounded-lg">
                    <i class="fas fa-chart-bar mr-2"></i>View Subject Breakdown
                </summary>
                <div class="mt-4 overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-dark-800 text-slate-300">
                                <th class="px-4 py-3 text-left">Subject</th>
                                <th class="px-4 py-3 text-center">Total Hours</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-dark-700">
                            {% for subj, count in main.summary.items() %}
                            <tr class="hover:bg-dark-800 transition-colors">
                                <td class="px-4 py-3 text-slate-300">{{ subj }}</td>
                                <td class="px-4 py-3 text-center">
                                    <span
                                        class="inline-block px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full text-sm font-semibold">{{
                                        count }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </details>

            <!-- Schedule Table -->
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="bg-blue-600 text-white">
                            <th class="px-3 py-2 text-left sticky left-0 bg-blue-600">Date (Day)</th>
                            {% for col_time in time_cols %}
                            <th class="px-2 py-2 text-center whitespace-nowrap">{{ col_time }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-dark-700">
                        {% for day in main.days %}
                        <tr
                            class="{% if day.is_special %}{% if 'Grand Test' in day.special_label %}bg-red-900/30{% else %}bg-emerald-900/30{% endif %}{% else %}hover:bg-dark-800{% endif %} transition-colors">
                            <td
                                class="px-3 py-2 font-semibold text-slate-300 sticky left-0 bg-dark-900 whitespace-nowrap">
                                {{ day.date_display }}</td>

                            {% if day.is_special %}
                            <td colspan="{{ time_cols|length }}"
                                class="px-3 py-3 text-center font-bold uppercase tracking-wide {% if 'Grand Test' in day.special_label %}text-red-400{% else %}text-emerald-400{% endif %}">
                                {{ day.special_label }}
                            </td>
                            {% else %}
                            {% for col_time in time_cols %}
                            <td class="px-2 py-2 text-center text-slate-400 text-xs">
                                {{ day.slots_map.get(col_time, '-') }}
                            </td>
                            {% endfor %}
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        <!-- Revision Timetable -->
        {% if rev.days %}
        <div class="card p-8 mb-8">
            <h2 class="text-2xl font-bold text-emerald-400 mb-6 pb-3 border-b border-dark-700">
                <i class="fas fa-sync-alt mr-2"></i>Part II: Revision Timetable
            </h2>

            <!-- Summary -->
            <details class="mb-6">
                <summary
                    class="cursor-pointer text-lg font-semibold text-slate-300 hover:text-white transition-colors p-4 bg-dark-800 rounded-lg">
                    <i class="fas fa-chart-bar mr-2"></i>View Revision Breakdown
                </summary>
                <div class="mt-4 overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-dark-800 text-slate-300">
                                <th class="px-4 py-3 text-left">Subject</th>
                                <th class="px-4 py-3 text-center">Total Hours</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-dark-700">
                            {% for subj, count in rev.summary.items() %}
                            <tr class="hover:bg-dark-800 transition-colors">
                                <td class="px-4 py-3 text-slate-300">{{ subj }}</td>
                                <td class="px-4 py-3 text-center">
                                    <span
                                        class="inline-block px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded-full text-sm font-semibold">{{
                                        count }}</span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </details>

            <!-- Schedule Table -->
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="bg-emerald-600 text-white">
                            <th class="px-3 py-2 text-left sticky left-0 bg-emerald-600">Date (Day)</th>
                            {% for col_time in time_cols %}
                            <th class="px-2 py-2 text-center whitespace-nowrap">{{ col_time }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-dark-700">
                        {% for day in rev.days %}
                        <tr
                            class="{% if day.is_special %}{% if 'Grand Test' in day.special_label %}bg-red-900/30{% else %}bg-emerald-900/30{% endif %}{% else %}hover:bg-dark-800{% endif %} transition-colors">
                            <td
                                class="px-3 py-2 font-semibold text-slate-300 sticky left-0 bg-dark-900 whitespace-nowrap">
                                {{ day.date_display }}</td>

                            {% if day.is_special %}
                            <td colspan="{{ time_cols|length }}"
                                class="px-3 py-3 text-center font-bold uppercase tracking-wide {% if 'Grand Test' in day.special_label %}text-red-400{% else %}text-emerald-400{% endif %}">
                                {{ day.special_label }}
                            </td>
                            {% else %}
                            {% for col_time in time_cols %}
                            <td class="px-2 py-2 text-center text-slate-400 text-xs">
                                {{ day.slots_map.get(col_time, '-') }}
                            </td>
                            {% endfor %}
                            {% endif %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        <!-- Motivational Quote -->
        <div class="text-center py-8">
            <p class="text-slate-500 italic text-lg">
                "{{ quotes[0] }}"
            </p>
        </div>

    </div>

</body>

</html>